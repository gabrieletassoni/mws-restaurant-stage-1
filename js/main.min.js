let restaurants,neighborhoods,cuisines;var mapUrl;document.addEventListener("DOMContentLoaded",event=>{fetchNeighborhoods(),fetchCuisines(),mapUrl="https://maps.googleapis.com/maps/api/staticmap?size=512x200&scale=2&zoom=11&center=40.722216,-73.987501&key=AIzaSyCZbDc-qSx_lvq7HvGB82_TKsKJmcIjlWw&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:mid%7Ccolor:red",updateRestaurants()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((error,neighborhoods)=>{error?console.error(error):(self.neighborhoods=neighborhoods,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((neighborhoods=self.neighborhoods)=>{const select=document.getElementById("neighborhoods-select");neighborhoods.forEach(neighborhood=>{const option=document.createElement("option");option.innerHTML=neighborhood,option.value=neighborhood,select.append(option)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((error,cuisines)=>{error?console.error(error):(self.cuisines=cuisines,fillCuisinesHTML())})}),fillCuisinesHTML=((cuisines=self.cuisines)=>{const select=document.getElementById("cuisines-select");cuisines.forEach(cuisine=>{const option=document.createElement("option");option.innerHTML=cuisine,option.value=cuisine,select.append(option)})}),updateRestaurants=(()=>{const cSelect=document.getElementById("cuisines-select"),nSelect=document.getElementById("neighborhoods-select"),cIndex=cSelect.selectedIndex,nIndex=nSelect.selectedIndex,cuisine=cSelect[cIndex].value,neighborhood=nSelect[nIndex].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine,neighborhood,(error,restaurants)=>{error?console.log(error):(resetRestaurants(restaurants),fillRestaurantsHTML())})}),resetRestaurants=(restaurants=>{self.restaurants=[];const ul=document.getElementById("restaurants-list");ul.innerHTML="",self.restaurants=restaurants}),fillRestaurantsHTML=((restaurants=self.restaurants)=>{const ul=document.getElementById("restaurants-list");restaurants.forEach(restaurant=>{ul.append(createRestaurantHTML(restaurant))}),addMarkersToMap(),lazyLoad()}),createRestaurantHTML=(restaurant=>{const imgUrl=DBHelper.imageUrlForRestaurant(restaurant,300),li=document.createElement("li"),noscriptImage=document.createElement("noscript");noscriptImage.setAttribute("data-src",imgUrl),noscriptImage.setAttribute("class","lazy-image");const image=document.createElement("img");image.className="restaurant-img",image.src=imgUrl,image.setAttribute("data-src",""),image.alt=`${restaurant.name} restaurant`,noscriptImage.append(image),li.append(noscriptImage);const isFavorite="true"===restaurant.is_favorite,name=document.createElement("h2");name.innerHTML=restaurant.name,li.append(name);const neighborhood=document.createElement("p");neighborhood.innerHTML=restaurant.neighborhood,li.append(neighborhood);const address=document.createElement("p");address.innerHTML=restaurant.address,li.append(address);const operationsContainer=document.createElement("p");operationsContainer.setAttribute("class","operations-container");const more=document.createElement("a");more.innerHTML="View Details",more.href=DBHelper.urlForRestaurant(restaurant),operationsContainer.append(more);const favouriteLink=document.createElement("span");return favouriteLink.setAttribute("class","fav-link"),favouriteLink.setAttribute("id",`fav-link-${restaurant.id}`),favouriteLink.innerHTML=isFavorite?"♥":"♡",favouriteLink.addEventListener("click",()=>{DBHelper.toggleFavourite(restaurant.id)}),operationsContainer.append(favouriteLink),li.append(operationsContainer),li}),lazyLoad=(()=>{[].forEach.call(document.querySelectorAll("noscript.lazy-image"),function(noscript){var img=new Image;img.setAttribute("data-src",""),img.className=noscript.firstElementChild.className,img.alt=noscript.firstElementChild.alt,noscript.parentNode.insertBefore(img,noscript),img.onload=function(){img.removeAttribute("data-src")},img.src=noscript.getAttribute("data-src")})}),addMarkersToMap=((restaurants=self.restaurants)=>{restaurants.forEach(restaurant=>{mapUrl+=`%7C${restaurant.latlng.lat},${restaurant.latlng.lng}`});const mapImg=document.getElementById("map");mapImg.alt="Map containing all restaurants locations",mapImg.src=mapUrl}),AppHelper.registerServiceWorker();