let restaurant;var mapUrl;function getQueryVariable(variable){for(var query,vars=window.location.search.substring(1).split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if(decodeURIComponent(pair[0])==variable)return decodeURIComponent(pair[1])}console.log("Query variable %s not found",variable)}document.body.onload=(event=>{fetchRestaurantFromURL((error,restaurant)=>{if(error)console.error(error);else{fillBreadcrumb(),mapUrl=`https://maps.googleapis.com/maps/api/staticmap?size=512x200&scale=2&zoom=11&center=${restaurant.latlng.lat},${restaurant.latlng.lng}&key=AIzaSyCZbDc-qSx_lvq7HvGB82_TKsKJmcIjlWw&maptype=roadmap&format=jpg&visual_refresh=true&markers=size:mid%7Ccolor:red%7C${restaurant.latlng.lat},${restaurant.latlng.lng}`;const mapImg=document.getElementById("map");mapImg.alt="Map containing current restaurant location",mapImg.src=mapUrl}})}),fetchRestaurantFromURL=(callback=>{if(self.restaurant)return void callback(null,self.restaurant);const id=getParameterByName("id");id?DBHelper.fetchRestaurantById(id,(error,restaurant)=>{self.restaurant=restaurant,restaurant?(fillRestaurantHTML(),callback(null,restaurant)):console.error(error)}):(error="No restaurant id in URL",callback(error,null))}),fillRestaurantHTML=((restaurant=self.restaurant)=>{const isFavorite="true"===restaurant.is_favorite,name=document.getElementById("restaurant-name");name.innerHTML=restaurant.name;const favouriteLink=document.createElement("a");favouriteLink.setAttribute("class","fav-link"),favouriteLink.setAttribute("id",`fav-link-${restaurant.id}`),favouriteLink.href="javascript:void(0);",favouriteLink.innerHTML=isFavorite?"♥":"♡",favouriteLink.addEventListener("click",()=>{DBHelper.toggleFavourite(restaurant.id)}),name.append(favouriteLink);const address=document.getElementById("restaurant-address");address.innerHTML=restaurant.address;const image=document.getElementById("restaurant-img");image.className="restaurant-img",image.src=DBHelper.imageUrlForRestaurant(restaurant,600),image.alt=`${restaurant.name} restaurant`;const cuisine=document.getElementById("restaurant-cuisine");cuisine.innerHTML=restaurant.cuisine_type,restaurant.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((operatingHours=self.restaurant.operating_hours)=>{const hours=document.getElementById("restaurant-hours");let i=51;for(let key in operatingHours){const row=document.createElement("tr"),day=document.createElement("td");day.innerHTML=key,row.appendChild(day);const time=document.createElement("td");time.innerHTML=operatingHours[key],row.appendChild(time),hours.appendChild(row)}}),fillReviewsHTML=((reviews=self.restaurant.reviews)=>{const container=document.getElementById("reviews-container"),title=document.createElement("h2");if(title.innerHTML="Reviews",container.appendChild(title),!reviews){const noReviews=document.createElement("p");return noReviews.innerHTML="No reviews yet!",void container.appendChild(noReviews)}const ul=document.getElementById("reviews-list");reviews.forEach(review=>{ul.appendChild(createReviewHTML(review))}),container.appendChild(ul)}),createReviewHTML=(review=>{const li=document.createElement("li"),name=document.createElement("p");name.innerHTML=review.name,li.appendChild(name);const date=document.createElement("p");date.innerHTML=Date(review.updatedAt),li.appendChild(date);const rating=document.createElement("p");rating.innerHTML=`Rating: ${review.rating}`,li.appendChild(rating);const comments=document.createElement("p");return comments.innerHTML=review.comments,li.appendChild(comments),li}),fillBreadcrumb=((restaurant=self.restaurant)=>{const breadcrumb=document.getElementById("breadcrumb"),li=document.createElement("li");li.innerHTML=restaurant.name,breadcrumb.appendChild(li)}),getParameterByName=((name,url)=>{url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");const regex=new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`),results=regex.exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}),submitForm=(()=>{const name=document.getElementById("name").value,ind=document.getElementById("rating").selectedIndex,rating=document.getElementById("rating").options.item(ind).text,comment=document.getElementById("comment").value,restaurant_id=document.getElementById("restaurant_id").value;if(""===name||""==comment)return;document.getElementById("submit").value="Submitting...",document.getElementById("submit").disabled=!0,document.getElementById("name").value=document.getElementById("comment").value="",document.getElementById("rating").selectedIndex=0;const reviewObj={restaurant_id:restaurant_id,name:name,createdAt:Date.now(),updatedAt:Date.now(),rating:rating,comments:comment};console.log(reviewObj),document.getElementById("submit").value="Submit",document.getElementById("submit").disabled=!1}),AppHelper.registerServiceWorker();